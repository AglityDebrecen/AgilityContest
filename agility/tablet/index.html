<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- try to disable zoom in tablet on double click -->
<meta content='width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=no;' name='viewport' />
<title>Agility Contest</title>
<link rel="stylesheet" type="text/css" href="/agility/lib/jquery-easyui-1.4/themes/default/easyui.css" />
<link rel="stylesheet" type="text/css" href="/agility/lib/jquery-easyui-1.4/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="/agility/css/style.css" />
<link rel="stylesheet" type="text/css" href="/agility/css/datagrid.css" />
<link rel="stylesheet" type="text/css" href="/agility/css/tablet.css" />
<script src="/agility/lib/jquery-easyui-1.4/jquery.min.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/lib/jquery-easyui-1.4/jquery.easyui.min.js" type="text/javascript" charset="utf-8" ></script>
<script src="/agility/lib/jquery-easyui-1.4/extensions/datagrid-dnd/datagrid-dnd.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/lib/jquery-easyui-1.4/extensions/datagrid-view/datagrid-detailview.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/lib/jquery-fileDownload-1.4.2.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/scripts/common.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/scripts/competicion.js" type="text/javascript" charset="utf-8" > </script>
<script src="/agility/tablet/tablet.js" type="text/javascript" charset="utf-8" > </script>

<script type="text/javascript">

// from:
// http://www.jeasyui.com/forum/index.php?topic=1775.msg3895#msg3895
// convert touch events into mouse ones

/* As jeasyui-1.4 already includes this code comment it */
 
 
/*
(function($){
	var longTouchTimer = null;
	var dblTouchTimer = null;
	var isDblClick = false;
	
	function onTouchStart(e){
		if (!isDblClick){
			isDblClick = true;
			dblClickTimer = setTimeout(function(){
				isDblClick = false;
			}, 500);
		} else {
			if (e.touches.length == 1){
				clearTimeout(dblClickTimer);
				isDblClick = false;
				fire(e, 'dblclick');
				e.preventDefault();
			}
		}
		longTouchTimer = setTimeout(function(){
			fire(e, 'contextmenu');
		}, 1000);
		fire(e, 'mousedown');
	}
	function onTouchMove(e){
		if (longTouchTimer){
			clearTimeout(longTouchTimer);
		}
		fire(e, 'mousemove');
	}
	function onTouchEnd(e){
		if (longTouchTimer){
			clearTimeout(longTouchTimer);
		}
		fire(e, 'mouseup');
	}
	
	function fire(e, name){
		var event = new $.Event(name);
		event.pageX = e.changedTouches[0].pageX;
		event.pageY = e.changedTouches[0].pageY;
		$(e.target).trigger(event);
	}
	
	if (document.addEventListener){
		document.addEventListener("touchstart", onTouchStart, true);
		document.addEventListener("touchmove", onTouchMove, true);
		document.addEventListener("touchend", onTouchEnd, true);
	}
})(jQuery);
*/
</script>

</head>

<body style="width:1024px;height:600px;margin:0;padding:0;background-color:blue">
<div id="tablet_contenido" style="width:inherit;height:inherit;margin:0;padding:0">

<!--  CUERPO PRINCIPAL DE LA PAGINA (se modifica con el menu) -->

<div id="seltablet-dialog" class="easyui-dialog" style="position:relative,width:600px;height:250px;padding:20px 20px">
	<form id="seltablet-form">
    	<div class="fitem">
       		<label for="Sesion">Sesi&oacute;n:</label>
       		<select id="seltablet-Sesion" name="Sesion" style="width:200px"></select>
    	</div>        		
    	<div class="fitem">
       		<label for="Prueba">Selecciona Prueba:</label>
       		<select id="seltablet-Prueba" name="Prueba" style="width:200px"></select>
    	</div>        		
    	<div class="fitem">
       		<label for="Jornada">Selecciona Jornada:</label>
       		<select id="seltablet-Jornada" name="Jornada" style="width:200px"></select>
    	</div>
	</form>
</div> <!-- Window -->

<div id="seltablet-Buttons" style="text-align:right">
   	<a id="seltablet-okBtn" href="#" class="easyui-linkbutton" 
   	   	data-options="iconCls:'icon-ok'" onclick="tablet_acceptSelectJornada()">Aceptar</a>
</div>	<!-- botones -->

<script type="text/javascript">
$('#seltablet-dialog').dialog({
	title: 'Selecciona la Prueba y Jornada a desplegar',
	collapsible: false,
	minimizable: false,
	maximizable: false,
	closable: true,
	closed: false,
	shadow: true,
	modal: true,
	buttons: '#seltablet-Buttons' 
});

$('#seltablet-form').form();

$('#seltablet-Prueba').combogrid({
	panelWidth: 400,
	panelHeight: 150,
	idField: 'ID',
	textField: 'Nombre',
	url: '/agility/server/database/pruebaFunctions.php?Operation=enumerate',
	method: 'get',
	mode: 'remote',
	required: true,
	multiple: false,
	fitColumns: true,
	singleSelect: true,
	editable: false,
	selectOnNavigation: true, // let use cursor keys to interactive select
	columns: [[
	   	    {field:'ID',hidden:true},
			{field:'Nombre',title:'Nombre',width:50,align:'right'},
			{field:'Club',hidden:true},
			{field:'NombreClub',title:'Club',width:20,align:'right'},
			{field:'Observaciones',title:'Observaciones.',width:30,align:'right'}
	]],
	onChange:function(value){
		workingData.prueba=Number(value);
		var g = $('#seltablet-Jornada').combogrid('grid');
		g.datagrid('load',{Prueba:value});
	}
});

$('#seltablet-Sesion').combogrid({
	panelWidth: 250,
	panelHeight: 100,
	idField: 'ID',
	textField: 'Nombre',
	url: '/agility/server/database/sessionFunctions.php',
	method: 'get',
	mode: 'remote',
	required: true,
	rownumber: true,
	multiple: false,
	fitColumns: true,
	singleSelect: true,
	editable: false,
	columns: [[
	    { field:'ID',			width:5, sortable:false, align:'center', title:'ID' }, // Session ID
		{ field:'Nombre',		width:30, sortable:false,   align:'right',  title: 'Nombre de sesión' }
	]],
	onBeforeLoad: function(param) { 
		param.Operation='enumerate'
		return true;
	}
});

$('#seltablet-Jornada').combogrid({
	panelWidth: 550,
	panelHeight: 150,
	idField: 'ID',
	textField: 'Nombre',
	url: '/agility/server/database/jornadaFunctions.php',
	method: 'get',
	mode: 'remote',
	required: true,
	multiple: false,
	fitColumns: true,
	singleSelect: true,
	editable: false,
	columns: [[
	    { field:'ID',			hidden:true }, // ID de la jornada
	    { field:'Prueba',		hidden:true }, // ID de la prueba
	    { field:'Numero',		width:4, sortable:false,	align:'center', title: '#'},
		{ field:'Nombre',		width:30, sortable:false,   align:'right',  title: 'Nombre/Comentario' },
		{ field:'Fecha',		hidden:true},
		{ field:'Hora',			hidden:true},
		{ field:'Grado1',		width:8, sortable:false,	align:'center', title: 'G-I    ' },
		{ field:'Grado2',		width:8, sortable:false,	align:'center', title: 'G-II   ' },
		{ field:'Grado3',		width:8, sortable:false,	align:'center', title: 'G-III  ' },
		{ field:'Open',		    width:8, sortable:false,	align:'center', title: 'Open   ' },
		{ field:'Equipos3',		width:8, sortable:false,	align:'center', title: 'Eq.3x4 ' },
		{ field:'Equipos4',		width:8, sortable:false,	align:'center', title: 'Eq.Conj' },
		{ field:'PreAgility',	width:8, sortable:false,	align:'center', title: 'Pre. 1 ' },
		{ field:'PreAgility2',	width:8, sortable:false,	align:'center', title: 'Pre. 2 ' },
		{ field:'KO',			width:8, sortable:false,	align:'center', title: 'K.O.   ' },
		{ field:'Especial',		width:8, sortable:false,	align:'center', title: 'Show   ' },
	]],
	onBeforeLoad: function(param) { 
		param.Operation='enumerate', 
		param.Prueba=workingData.prueba;
		param.AllowClosed=0;
		return true;
	}
});

function tablet_acceptSelectJornada() {
	// si prueba invalida cancelamos operacion
	var s=$('#seltablet-Sesion').combogrid('grid').datagrid('getSelected');
	var p=$('#seltablet-Prueba').combogrid('grid').datagrid('getSelected');
	var j=$('#seltablet-Jornada').combogrid('grid').datagrid('getSelected');
	if ( (p==null) || (j==null) ) {
		// indica error
		$.messager.alert("Error","Debe<br />- Indicar la sesión para los videomarcadores<br />- Seleccionar prueba/jornada para manejo de datos","error");
		return;
	}

	// update database session info with provided operator data
	updateSessionInfo(s.ID,{Nombre: s.Nombre,Prueba:p.ID, Jornada:j.ID});
	// los demas valores se actualizan en la linea anterior
	workingData.nombreSesion=s.Nombre;
	workingData.nombrePrueba=p.Nombre;
	workingData.nombreJornada=j.Nombre;
	// notify session open() to event manager
	tablet_putEvent(
		'open',
		{ 'Session': s.ID, 'Source': 'tablet_'+s.ID, 'Prueba': p.ID, 'Jornada': j.ID, 'Manga':	0, 'Tanda':	0, 'Perro':	0 }
	);

	var page="/agility/tablet/tablet_competicion.php";
	if (workingData.datosJornada.Equipos3==1) {
		page="/agility/tablet/tablet_competicion_eq3.php";
	}
	if (workingData.datosJornada.Equipos4==1) {
		page="/agility/tablet/tablet_competicion_eq4.php";
	}
	if (workingData.datosJornada.Open==1) {
		page="/agility/tablet/tablet_competicion_open.php";
	}
	if (workingData.datosJornada.KO==1) {
		page="/agility/tablet/tablet_competicion_ko.php";
	}
	$('#seltablet-dialog').dialog('close');
	$('#tablet_contenido').load(	
			page,
			function(response,status,xhr){
				if (status=='error') $('#tablet_contenido').load('/agility/frm_notavailable.php');
			}
		);
		
}
</script>
</div> <!-- contenido -->
</body>
</html> 
